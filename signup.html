<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø«Ø¨Øª Ù†Ø§Ù…</title>
    <link rel="shortcut icon" href="./logo.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #0f3460, #00D084);
            font-family: 'Vazirmatn', sans-serif;
            margin: 0;
            padding: 15px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            padding: 28px;
            box-shadow: 0 12px 30px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 380px;
        }

        h2 {
            text-align: center;
            color: #003366;
            margin-bottom: 10px;
            font-size: 24px;
            font-weight: 700;
        }

        .input-group {
            margin-bottom: 5px;
        }

        label {
            display: block;
            margin-bottom: 2px;
            font-weight: 600;
            font-size: 16px;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 30px;
            font-size: 17px;
            box-sizing: border-box;
        }

        .password-wrapper {
            position: relative;
        }

        .toggle-eye {
            position: absolute;
            left: 15px;
            top: 70%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 22px;
            color: #666;
        }

        #register-btn {
            width: 100%;
            padding: 14px;
            background: #00D084;
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        #register-btn:hover {
            background: #00b36b;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,208,132,0.4);
        }

        /* Ø¢ÛŒÚ©Ù† Ú†Øª */
        .support-icon {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 9999;
            background: #00D084;
            color: white;
            width: 65px;
            height: 65px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            box-shadow: 0 10px 25px rgba(0,208,132,0.5);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .support-icon:hover {
            transform: scale(1.12);
            box-shadow: 0 15px 35px rgba(0,208,132,0.6);
        }

        /* Ú©Ø§Ø¯Ø± Ú†Øª */
        #support-modal {
            position: fixed;
            bottom: 110px;
            left: 30px;
            width: 360px;
            max-height: 65vh;
            background: transparent;
            z-index: 10000;
            display: none;
        }

        #support-modal.show {
            display: block;
        }

        .modal-box {
            background: white;
            border-radius: 20px;
            box-shadow: 0 -12px 35px rgba(0,0,0,0.25);
            overflow: hidden;
            border: 1px solid rgba(0,208,132,0.2);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .modal-box h2 {
            margin: 0;
            padding: 16px 20px;
            background: linear-gradient(135deg, #00D084, #00b36b);
            color: white;
            font-size: 18px;
            text-align: center;
        }
        #back-btn {
            width: 100%;
            padding: 15px;
            background: #003366;
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        #back-btn:hover {
            background: #002244;
            transform: translateY(-2px);
        }

        #support-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 12px;
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 80%;
            font-size: 15px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .message.user {
            background: #00D084;
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }

        .message.admin {
            background: #e0e0e0;
            color: #333;
            margin-right: auto;
            border-bottom-left-radius: 4px;
        }

        .input-area {
            display: flex;
            padding: 12px;
            background: white;
            border-top: 1px solid #eee;
        }

        #support-input {
            flex: 1;
            padding: 12px 18px;
            border: 1.5px solid #ddd;
            border-radius: 30px;
            font-size: 15px;
            outline: none;
        }

        #send-support-btn {
            margin-left: 10px;
            background: #00D084;
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 22px;
            cursor: pointer;
            transition: all 0.2s;
        }

        #send-support-btn:hover {
            background: #00b36b;
            transform: scale(1.1);
        }

        .close {
            position: absolute;
            top: 12px;
            left: 15px;
            font-size: 32px;
            color: white;
            cursor: pointer;
            z-index: 10;
        }

        @media (max-width: 480px) {
            #support-modal {
                bottom: 90px;
                left: 10px;
                right: 10px;
                width: auto;
                max-height: 60vh;
            }

            .support-icon {
                bottom: 20px;
                left: 20px;
                width: 55px;
                height: 55px;
                font-size: 28px;
            }
        }

        #toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #4caf50;
            color: white;
            padding: 16px 32px;
            border-radius: 30px;
            font-size: 16px;
            display: none;
            z-index: 1000;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
        .snow-container {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }
        .snowflake {
            position: absolute;
            width: 5px;
            height: 5px;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            box-shadow: 0 0 6px rgba(255,255,255,0.9);
            animation: fall linear infinite;
            top: -20px;
        }

        /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø§ÙØªØ§Ø¯Ù† Ø¨Ø±Ù */
        @keyframes fall {
            0% {
                transform: translateY(-20vh) translateX(0vw) rotate(0deg);
            }
            100% {
                transform: translateY(120vh) translateX(30vw) rotate(720deg);
            }
        }

        /* ØªØ¹Ø¯Ø§Ø¯ Ø¯ÙˆÙ†Ù‡â€ŒÙ‡Ø§ Ùˆ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ø±ÙˆØ¹ (Ø§Ø² Ø¨Ø§Ù„Ø§-Ø±Ø§Ø³Øª) */
        .snowflake:nth-child(1)  { left: 3%;  animation-duration: 7s;   animation-delay: 0s;   }
        .snowflake:nth-child(2)  { left: 6%;  animation-duration: 6.5s; animation-delay: 0.4s; }
        .snowflake:nth-child(3)  { left: 9%;  animation-duration: 8s;   animation-delay: 0.9s; }
        .snowflake:nth-child(4)  { left: 12%; animation-duration: 5.8s; animation-delay: 1.3s; }
        .snowflake:nth-child(5)  { left: 15%; animation-duration: 7.2s; animation-delay: 1.9s; }
        .snowflake:nth-child(6)  { left: 18%; animation-duration: 6.8s; animation-delay: 0.6s; }
        .snowflake:nth-child(7)  { left: 21%; animation-duration: 9s;   animation-delay: 2.6s; }
        .snowflake:nth-child(8)  { left: 24%; animation-duration: 6.4s; animation-delay: 1.6s; }
        .snowflake:nth-child(9)  { left: 27%; animation-duration: 8.2s; animation-delay: 3.1s; }
        .snowflake:nth-child(10) { left: 30%; animation-duration: 7.5s; animation-delay: 1.0s; }
        .snowflake:nth-child(11) { left: 33%; animation-duration: 7.8s; animation-delay: 2.3s; }
        .snowflake:nth-child(12) { left: 36%; animation-duration: 6.2s; animation-delay: 1.8s; }
        .snowflake:nth-child(13) { left: 39%; animation-duration: 8.5s; animation-delay: 3.6s; }
        .snowflake:nth-child(14) { left: 42%; animation-duration: 9.2s; animation-delay: 4.1s; }
        .snowflake:nth-child(15) { left: 45%; animation-duration: 6.8s; animation-delay: 0.5s; }
        .snowflake:nth-child(16) { left: 48%; animation-duration: 7.4s; animation-delay: 2.9s; }
        .snowflake:nth-child(17) { left: 51%; animation-duration: 8s;   animation-delay: 1.4s; }
        .snowflake:nth-child(18) { left: 54%; animation-duration: 10s;  animation-delay: 4.6s; }
        .snowflake:nth-child(19) { left: 57%; animation-duration: 7.2s; animation-delay: 0.8s; }
        .snowflake:nth-child(20) { left: 60%; animation-duration: 8.8s; animation-delay: 3.3s; }
        .snowflake:nth-child(21) { left: 63%; animation-duration: 6.6s; animation-delay: 2.2s; }
        .snowflake:nth-child(22) { left: 66%; animation-duration: 9.2s; animation-delay: 5.1s; }
        .snowflake:nth-child(23) { left: 69%; animation-duration: 7.8s; animation-delay: 1.7s; }
        .snowflake:nth-child(24) { left: 72%; animation-duration: 8.4s; animation-delay: 3.9s; }
        .snowflake:nth-child(25) { left: 75%; animation-duration: 6.4s; animation-delay: 0.9s; }
        .snowflake:nth-child(26) { left: 78%; animation-duration: 9.5s; animation-delay: 4.4s; }
        .snowflake:nth-child(27) { left: 81%; animation-duration: 7s;   animation-delay: 1.5s; }
        .snowflake:nth-child(28) { left: 84%; animation-duration: 8.2s; animation-delay: 3.7s; }
        .snowflake:nth-child(29) { left: 87%; animation-duration: 6.8s; animation-delay: 2.5s; }
        .snowflake:nth-child(30) { left: 90%; animation-duration: 10s;  animation-delay: 5.6s; }
        .snowflake:nth-child(31) { left: 93%; animation-duration: 7.2s; animation-delay: 0.7s; }
        .snowflake:nth-child(32) { left: 96%; animation-duration: 8.5s; animation-delay: 4.9s; }
        .snowflake:nth-child(33) { left: 98%; animation-duration: 6s;   animation-delay: 1.1s; }
        .snowflake:nth-child(34) { left: 99%; animation-duration: 9s;   animation-delay: 4.2s; }
        .snowflake:nth-child(35) { left: 4%;  animation-duration: 7.5s; animation-delay: 2.8s; }
        .snowflake:nth-child(36) { left: 7%;  animation-duration: 8s;   animation-delay: 3.4s; }
        .snowflake:nth-child(37) { left: 11%; animation-duration: 6.5s; animation-delay: 0.2s; }
        .snowflake:nth-child(38) { left: 14%; animation-duration: 8.8s; animation-delay: 4.7s; }
        .snowflake:nth-child(39) { left: 17%; animation-duration: 7s;   animation-delay: 1.9s; }
        .snowflake:nth-child(40) { left: 19%; animation-duration: 9.2s; animation-delay: 5.3s; }

        .snowflake.small  { width: 4px; height: 4px; }
        .snowflake.large  { width: 8px; height: 8px; opacity: 0.95; }
    </style>
</head>
<body>
    <div class="snow-container">
        <div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div>
        <div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div>
        <div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div>
        <div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div>
        <div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div>
        <div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div>
        <div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div>
        <div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div>
        <div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div>
        <div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div><div class="snowflake"></div>
    </div>

    <div class="container">
        <h2>Ø«Ø¨Øª Ù†Ø§Ù…</h2>

        <div class="input-group">
            <label>Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
            <input type="text" id="fullName">
        </div>

        <div class="input-group">
            <label>Ú©Ø¯ Ù…Ù„ÛŒ</label>
            <input type="text" id="nationalCode" maxlength="10">
        </div>

        <div class="input-group">
            <label>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</label>
            <input type="text" id="phone" maxlength="11" placeholder="09xxxxxxxxx">
        </div>

        <div class="input-group">
            <label>ØªÛŒÙ… ÙÙˆØªØ¨Ø§Ù„ Ù…ÙˆØ±Ø¯ Ø¹Ù„Ø§Ù‚Ù‡</label>
            <input type="text" id="favoriteTeam">
        </div>

        <div class="input-group">
            <label>Ø±Ù†Ú¯ Ù…ÙˆØ±Ø¯ Ø¹Ù„Ø§Ù‚Ù‡</label>
            <input type="text" id="favoriteColor">
        </div>

        <div class="input-group password-wrapper">
            <label>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
            <input type="password" id="password">
            <span class="toggle-eye" onclick="toggleEye(this)">ğŸ‘ï¸</span>
        </div>

        <div class="input-group password-wrapper">
            <label>ØªÚ©Ø±Ø§Ø± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
            <input type="password" id="confirmPassword">
            <span class="toggle-eye" onclick="toggleEye(this)">ğŸ‘ï¸</span>
        </div>

        <button id="register-btn">Ø«Ø¨Øª Ù†Ø§Ù…</button>
        <button id="back-btn" onclick="window.location.href='index.html'">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    </div>

    <!-- toast -->
    <div id="toast"></div>

    <!-- Ø¢ÛŒÚ©Ù† Ú†Øª -->
    <div class="support-icon" id="support-icon">ğŸ§</div>

    <!-- Ú©Ø§Ø¯Ø± Ú†Øª -->
    <div id="support-modal">
        <div class="modal-box">
            <span class="close">Ã—</span>
            <h2>Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ†</h2>
            <p style="text-align:center;color:#666;font-size:14px;margin:8px 0 16px;">Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯</p>
            <div id="support-messages"></div>
            <div class="input-area">
                <input type="text" id="support-input" placeholder="Ù¾ÛŒØ§Ù…...">
                <button id="send-support-btn">â¤</button>
            </div>
        </div>
    </div>

    <script>
        // Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù„ÙˆÚ©Ø§Ù„
        const STORAGE_KEY = 'schoolAppData';

        function getAppData() {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : { users: {}, chats: {}, currentUser: null };
        }
        
        function saveAppData(data) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        // Ù†Ù…Ø§ÛŒØ´ toast
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.background = type === 'success' ? '#4caf50' : '#f44336';
            toast.style.display = 'block';
            setTimeout(() => toast.style.display = 'none', 3000);
        }

        // ØªØºÛŒÛŒØ± Ù†Ù…Ø§ÛŒØ´ Ø±Ù…Ø²
        function toggleEye(el) {
            const input = el.previousElementSibling;
            input.type = input.type === 'password' ? 'text' : 'password';
            el.textContent = input.type === 'text' ? 'ğŸ™ˆ' : 'ğŸ‘ï¸';
        }

        // Ø«Ø¨Øª Ù†Ø§Ù…
        document.getElementById('register-btn').addEventListener('click', () => {
    const fullName = document.getElementById('fullName').value.trim();
    const nationalCode = document.getElementById('nationalCode').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const favoriteTeam = document.getElementById('favoriteTeam').value.trim();
    const favoriteColor = document.getElementById('favoriteColor').value.trim();
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirmPassword').value;

    if (!fullName || !nationalCode || !phone || !favoriteTeam || !favoriteColor || !password) {
        alert('Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø§Ù„Ø²Ø§Ù…ÛŒ Ù‡Ø³ØªÙ†Ø¯');
        return;
    }

    if (password !== confirmPassword) {
        alert('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ùˆ ØªÚ©Ø±Ø§Ø± Ø¢Ù† ÛŒÚ©Ø³Ø§Ù† Ù†ÛŒØ³Øª');
        return;
    }

    const data = getAppData();

    if (data.users[nationalCode]) {
        alert('Ú©Ø¯ Ù…Ù„ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ø§Ø³Øª');
        return;
    }

    data.users[nationalCode] = {
        fullName,
        phone,
        favoriteTeam,
        favoriteColor,
        password,
        grade: '',
        field: '',
        address: '',
        postalCode: '',
        registered: false,
        theme: 'light'
    };

    data.currentUser = nationalCode;          // â† Ø§ÛŒÙ† Ø®Ø· Ø®ÛŒÙ„ÛŒ Ù…Ù‡Ù…Ù‡!
    localStorage.setItem('nationalCode', nationalCode); // â† Ø§ÛŒÙ†Ù… Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†

    saveAppData(data);

    alert('Ø«Ø¨Øª Ù†Ø§Ù… Ù…ÙˆÙÙ‚! Ø­Ø§Ù„Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯.');
    window.location.href = 'index.html';
});

        // Ú†Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù„ÙˆÚ©Ø§Ù„
        document.addEventListener('DOMContentLoaded', () => {
            let guestId = localStorage.getItem('guestChatId');
            if (!guestId) {
                guestId = 'guest-' + Math.floor(100000 + Math.random() * 900000);
                localStorage.setItem('guestChatId', guestId);
            }

            const supportIcon = document.getElementById('support-icon');
            const supportModal = document.getElementById('support-modal');
            const supportMessages = document.getElementById('support-messages');
            const supportInput = document.getElementById('support-input');
            const sendBtn = document.getElementById('send-support-btn');

            if (supportIcon && supportModal) {
                supportIcon.addEventListener('click', () => {
                    supportModal.classList.add('show');
                    loadChatMessages();
                });
            }

            document.querySelector('.close')?.addEventListener('click', () => {
                supportModal.classList.remove('show');
            });

            supportModal?.addEventListener('click', e => {
                if (e.target === supportModal) {
                    supportModal.classList.remove('show');
                }
            });

            function loadChatMessages() {
                const data = getAppData();
                const chat = data.chats[guestId] || [];

                supportMessages.innerHTML = chat.length === 0 
                    ? '<p style="text-align:center;color:#999;">Ø­Ø§Ù„Ø§ Ø³ÙˆØ§Ù„ ÛŒØ§ Ù…Ø´Ú©Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù¾Ø±Ø³ÛŒØ¯ ğŸ˜Š</p>'
                    : '';

                chat.forEach(msg => {
                    const div = document.createElement('div');
                    div.className = `message ${msg.from}`;
                    div.textContent = msg.text;
                    supportMessages.appendChild(div);
                });

                supportMessages.scrollTop = supportMessages.scrollHeight;
            }

            function sendSupportMessage() {
                const text = supportInput.value.trim();
                if (!text) return;

                const data = getAppData();
                if (!data.chats[guestId]) data.chats[guestId] = [];

                data.chats[guestId].push({
                    from: 'user',
                    text,
                    timestamp: new Date().toISOString()
                });

                saveAppData(data);
                supportInput.value = '';
                loadChatMessages();

                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø§Ø³Ø® Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø¹Ø¯ Ø§Ø² Û± Ø«Ø§Ù†ÛŒÙ‡ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
                setTimeout(() => {
                    data.chats[guestId].push({
                        from: 'admin',
                        text: 'Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯. Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ù¾Ø§Ø³Ø® Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ….',
                        timestamp: new Date().toISOString()
                    });
                    saveAppData(data);
                    loadChatMessages();
                }, 1500);
            }

            sendBtn?.addEventListener('click', sendSupportMessage);
            supportInput?.addEventListener('keypress', e => {
                if (e.key === 'Enter') sendSupportMessage();
            });
        });
    </script>
</body>
</html>